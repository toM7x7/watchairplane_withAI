# 対話UI（Chat）

本PoCにはCLI風の対話UIが含まれます。既定では `services/flight-proxy` の `/chat` を叩き、`GEMINI_API_KEY` が設定されている場合にGeminiへ接続します（未設定時はスタブ）。

## 使い方
- 左下のパネルにプロンプトを入力し、Enter（または送信ボタン）で送信。
- シフト+Enterで改行。
- ログはタイプライター演出＋SEで表示。スキップで即時表示に切り替え。
- クリアで履歴をリセット。

### 3Dチャットパネル（Plane連動）
- Quest 3のARでは、水平プレーンを検出すると、その中央に3Dチャットパネル（キャンバス）が生成されます。
- ペルソナや選択中フライト、最近のメッセージ（最大6件）がパネルにも描画されます（読み取り専用）。
- 未対応端末では自動でフォールバックし、HTML側の対話UIのみ有効です。

## オプション
- ペルソナ: ガイド/CA/管制官/航空オタク。システムプロンプトとして送信前に埋め込み。
- フライト文脈: 選択中の機体情報（callsign/位置/高度/速度など）をコンテキストとして送信。
- 読み上げ: 応答を簡易TTS（ブラウザ SpeechSynthesis）で読み上げ。

## サーバ設定
- 環境変数
  - `GEMINI_API_KEY`: Gemini APIキー
  - `GEMINI_MODEL`（任意）: 既定 `gemini-pro`
- エンドポイント
  - `POST /chat`（JSON）: `{ input, system?, history?, flight? }`
    - `history`: `{ role: 'user'|'assistant', text: string }[]` を最大10件まで
    - `flight`: 選択中フライトのメタデータ（送信側が付与）

## 注意
- PoCのため安全フィルタやプロンプト注入対策は最小限です。公開環境では追加の対策が必要です。
